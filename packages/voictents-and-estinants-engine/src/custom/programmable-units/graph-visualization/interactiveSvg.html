<script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.5.0/dist/svg-pan-zoom.min.js"></script>
<body>
  <!-- SVG_PLACEHOLDER -->
</body>
<script>
  svgPanZoom('svg', {
    zoomScaleSensitivity: .3,
    minZoom: .2,
    maxZoom: 20,
  })

  const nodeList = [...document.getElementsByClassName('node')];

  const setEdgeColor = (element, color) => {
    element.setAttribute('stroke', color)

    if (element.tagName === 'polygon') {
      element.setAttribute('fill', color)
    }
  }

  nodeList.forEach((node) => {
    node.addEventListener('click', () => {
      nodeList.forEach((node) => {
        node.querySelector('polygon').setAttribute('stroke', 'black');
      })

      node.querySelector('polygon').setAttribute('stroke', 'orange');

      const id = node.getAttribute('id');

      console.log(id)

      const allEdgeList = document.querySelectorAll('.edge > path, .edge > polygon');

      const incomingEdgeList = document.querySelectorAll(`.edge.head-${id} > path, .edge.head-${id} > polygon`)
      const outgoingEdgeList = document.querySelectorAll(`.edge.tail-${id} > path, .edge.tail-${id} > polygon`)

      // TODO: make this trigger once per edge, not twice
      Array.from(incomingEdgeList).forEach((element) => {
        const classNameList = element.parentElement.getAttribute('class').split(' ');

        const tailClass = classNameList.find((className) => className.startsWith('tail-'));
        const tailId = tailClass.split('tail-')[1]

        const tailElement = document.getElementById(tailId);
        tailElement.querySelector('polygon').setAttribute('stroke', 'green');
      })

      // TODO: make this trigger once per edge, not twice
      Array.from(outgoingEdgeList).forEach((element) => {
        const classNameList = element.parentElement.getAttribute('class').split(' ');

        const tailClass = classNameList.find((className) => className.startsWith('head-'));
        const headId = tailClass.split('head-')[1]

        const headElement = document.getElementById(headId);
        headElement.querySelector('polygon').setAttribute('stroke', 'blue');
      })

      allEdgeList.forEach((element) => {
        setEdgeColor(element, 'gray');
      })

      incomingEdgeList.forEach((element) => {
        setEdgeColor(element, 'green');
      })

      outgoingEdgeList.forEach((element) => {
        setEdgeColor(element, 'blue');
      })

      console.log(incomingEdgeList);
      console.log(outgoingEdgeList);
      console.log('---')
    })
  })
</script>
